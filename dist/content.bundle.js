(()=>{const e=new class{constructor(e=10,t=6e4){this.requests=[],this.maxRequests=e,this.timeWindow=t}canMakeRequest(){const e=Date.now();return this.requests=this.requests.filter((t=>e-t<this.timeWindow)),this.requests.length<this.maxRequests&&(this.requests.push(e),!0)}},t={x:{mediaSelector:'[data-testid="attachments"]',altTextInputSelector:'[aria-label="Image description"]',imageSelector:'img[src*="media"]'},bluesky:{mediaSelector:".composer-media",altTextInputSelector:'textarea[placeholder*="Alt text"]',imageSelector:'img[src*="cdn"]'}};async function n(e){return new Promise(((t,n)=>{try{const n=document.createElement("canvas");n.width=e.naturalWidth,n.height=e.naturalHeight,n.getContext("2d").drawImage(e,0,0),t(n.toDataURL("image/jpeg").split(",")[1])}catch(e){n(e)}}))}async function s(t){if(!e.canMakeRequest())throw new Error("Rate limit exceeded. Please try again later.");try{const e=await fetch("https://vision.googleapis.com/v1/images:annotate?key=undefined",{method:"POST",body:JSON.stringify({requests:[{image:{content:t},features:[{type:"LABEL_DETECTION",maxResults:5},{type:"OBJECT_LOCALIZATION",maxResults:5},{type:"TEXT_DETECTION"},{type:"IMAGE_PROPERTIES"}]}]})});if(!e.ok)throw new Error(`API call failed: ${e.statusText}`);return await e.json()}catch(e){return console.error("Vision API error:",e),null}}function a(e){if(!e||!e.responses||!e.responses[0])return"Image description unavailable";const t=e.responses[0],n=[];if(t.labelAnnotations&&t.labelAnnotations.length>0){const e=t.labelAnnotations.slice(0,3).map((e=>e.description)).join(", ");n.push(`Contains: ${e}`)}if(t.localizedObjectAnnotations&&t.localizedObjectAnnotations.length>0){const e=t.localizedObjectAnnotations.slice(0,3).map((e=>e.name.toLowerCase())).join(", ");n.push(`Objects detected: ${e}`)}if(t.textAnnotations&&t.textAnnotations[0]){const e=t.textAnnotations[0].description.split("\n")[0];e&&e.length<100&&n.push(`Text visible: "${e}"`)}return n.join(". ")||"Image description unavailable"}async function o(){const e="x.com"===window.location.hostname?"x":"bluesky",o=t[e];new MutationObserver((async e=>{for(const t of e)if(document.querySelector(o.mediaSelector)){const e=document.querySelector(o.altTextInputSelector),t=document.querySelector(o.imageSelector);if(e&&t&&!e.value)try{const o=await n(t),i=await s(o);if(i){const t=a(i);e.value=t,e.dispatchEvent(new Event("input",{bubbles:!0}))}}catch(t){console.error("Error generating alt text:",t),e.value="Error generating description. Please add alt text manually.",e.dispatchEvent(new Event("input",{bubbles:!0}))}}})).observe(document.body,{childList:!0,subtree:!0})}document.addEventListener("DOMContentLoaded",o),o()})();